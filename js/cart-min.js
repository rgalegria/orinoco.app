document.addEventListener("DOMContentLoaded",()=>{fillCart()});const reservedCamerasMsg=document.getElementById("articles-msg"),emptyCartMsg=document.getElementById("empty-cart"),ctaBlock=document.getElementById("cta-block"),cartPilot=document.getElementById("cart-pilot"),apiGetUrl="https://orinoco-backend.herokuapp.com/api/cameras/",cartPath="/cart/",actualPath=new URL(window.location);let subTotalCart=0,shippingCost=0,totalCart=0;const tva=.22;class Product{constructor(t,e,a){this.id=t,this.lens=e,this.price=a}}const fillCart=()=>{let t=getCart();if(null!==t){if(!(Object.keys(t).length>0))return;for(productIndex in t)getProductById(t[productIndex].id,productIndex,t[productIndex].lens).then(t=>{addProductToCart(t)});changeCartVisual()}else updateCart({})},addProduct=()=>{const t=document.getElementById("lens-option");if("none"!=t.value){const e=document.getElementById("add-product-btn");let a=new URL(window.location.href).searchParams.get("id");e.style.background="#00b61d",e.textContent="AJOUTÉ !",e.disabled=!0,setTimeout(()=>{e.style.removeProperty("background"),e.textContent="AJOUTER AU PANIER",e.disabled=!1},1500);const n=new Product(a,t.value,productObject.price);let r=getCart();if(null!==r){let e="prod"+(new Date).getTime();r[e]=n,updateCart(r),getProductById(a,e,t.value).then(t=>{addProductToCart(t)})}}else alert("Veillez rentrer un option d'objectif")},addProductToCart=t=>{let e="",a="";t.lenses.forEach(a=>{let n;n=a==t.selectedLens?'selected="selected"':"",e+=`<option class="lens__dropd__item" value="${a}" ${n}>${a}</option>`}),a="/cart/"!==actualPath.pathname?`<div class="cart__menu__product__dropd">\n                        <p class="cart__menu__product__dropd__lens">${t.selectedLens}</p>\n                    </div>\n                </div>\n            </div>\n        </div>`:`<div class="lens__dropd cart__menu__product__dropd">\n                            <select\n                            id="lens-cart-option"\n                            class="lens__dropd__btn cart__menu__product__dropd__btn">\n                                <option class="lens__dropd__item" value="none">Veuillez choisir</option>\n                                ${e}\n                            </select>\n                        </div>\n                    </div>\n                </div>\n            </div>`;let n=`<div id="prod${t.productIndex}" style="border-bottom: 2px solid #000000;">\n                    <button\n                        id="delete-btn" onclick="removeProduct('${t.productIndex}')"\n                        class="cart__menu__product__del-btn delete-btn">\n                            <img src="https://rgalegria.github.io/orinoco.app/img/btn-close-icon.svg" alt="supprimer" />\n                    </button>\n                    <div class="cart__menu__product__wrapper-main">\n                        <div class="cart__menu__product__img" \n                            style="background-image: url(${t.imageUrl}); \n                            background-position: center; \n                            background-size: cover; \n                            background-repeat: no-repeat; \n                            background-color: white;">\n                        </div>\n                        <div class="cart__menu__product__wrapper-info">\n                            <h2 class="cart__menu__product__title">${t.name}</h2>\n                            <h3 class="cart__menu__product__price">${priceFormat(t.price)} &euro;</h3>\n                            ${a}`,r=document.getElementById("cart-container");return r.innerHTML=r.innerHTML+n,calculateTotalPrice(t.price,"add"),!0},getProductById=async(t,e,a)=>{let n=await fetch(apiGetUrl+t).catch(t=>{}),r=await n.json();return r.productIndex=e,r.selectedLens=a,r},getCart=()=>{let t=localStorage.getItem("cart");return null!==t?JSON.parse(t):null},updateCart=t=>{t=JSON.stringify(t),localStorage.setItem("cart",t),changeCartVisual()},changeCartVisual=()=>{if(reservedCamerasMsg&&emptyCartMsg&&null!==ctaBlock){let t=getCart();Object.keys(t).length>0?(reservedCamerasMsg.style.display="flex",emptyCartMsg.style.display="none",ctaBlock.style.display="block",cartPilot.style.display="block"):(reservedCamerasMsg.style.display="none",emptyCartMsg.style.display="block",ctaBlock.style.display="none",cartPilot.style.display="none")}},calculateTotalPrice=(t,e)=>{const a=document.getElementById("subtotal-price"),n=document.getElementById("shipping-price"),r=document.getElementById("tax-price"),o=document.getElementById("grand-total");"add"===e?subTotalCart+=t:subTotalCart-=t,shippingCost=subTotalCart>=1?1500:0;let c=calculateTax(subTotalCart);totalCart=subTotalCart+shippingCost,a.textContent=priceFormat(subTotalCart)+" €",n&&r&&null!==o&&(n.textContent=priceFormat(shippingCost)+" €",r.textContent=priceFormat(c)+" €",o.textContent=priceFormat(totalCart)+" €")},removeProduct=t=>{let e=getCart();null!==e&&(document.getElementById("prod"+t).remove(),calculateTotalPrice(e[t].price,"substract"),delete e[t],updateCart(e),changeCartVisual())},priceFormat=t=>parseFloat(t/100).toFixed(2),calculateTax=t=>t*tva,setlensDropdownDomElement=()=>{setTimeout(()=>{"/cart/"===actualPath.pathname&&document.getElementById("lens-cart-option")},500)};